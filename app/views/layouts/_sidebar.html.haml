- view   ||= controller.controller_name
- action ||= controller.action_name
- sidebar = "#{view}/sidebar_#{action}" unless action.to_s == 'show'
- sidebar = "admin/#{sidebar}" if controller.class.to_s.starts_with?("Admin::")

= content_for :sidebar
- begin
  = render sidebar if sidebar
  - rescue MissingTemplate

-# These widgets are rendered on nearly every page and are DB-heavy.
-# Cache briefly to cut repeated queries and allocations (especially with remote DB latency).
- cache(["sidebar-widgets", current_user&.id, I18n.locale.to_s], expires_in: 60.seconds) do
  = render "lists/lists"
  = render "shared/recently"
